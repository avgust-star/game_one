<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–°—Ç–∞—Ä—Ç–∞–ø-–ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä | iOS Control Center Concept</title>
    
    <style>
        /* --- –¶–≤–µ—Ç–æ–≤–∞—è –ü–∞–ª–∏—Ç—Ä–∞ –∏ –≠—Ñ—Ñ–µ–∫—Ç—ã --- */
        :root {
            --ios-dark-bg: #1a1a1c; 
            --ios-module-bg: rgba(255, 255, 255, 0.08); 
            --ios-module-border: rgba(255, 255, 255, 0.05); 
            --ios-active-color: #0a84ff; 
            --ios-text-color: #ffffff;
            --ios-blur-strength: 20px; 
            --ios-red: #ff3b30;
            --ios-green: #34c759;
            --ios-orange: #ff9500;
        }

        /* --- –û–±—â–∏–µ —Å—Ç–∏–ª–∏ --- */
        body {
            font-family: 'SF Pro Display', 'Helvetica Neue', Arial, sans-serif;
            background-color: var(--ios-dark-bg); 
            color: var(--ios-text-color);
            text-align: center;
            padding: 20px;
            line-height: 1.5;
            min-height: 100vh; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            margin: 0; 
            overflow-y: auto;
        }

        h1 {
            color: var(--ios-text-color);
            margin-bottom: 25px;
            font-weight: 700;
            font-size: 2.5em;
            letter-spacing: -0.5px;
            opacity: 0.9;
        }
        
        h2 {
            color: var(--ios-text-color);
            padding-bottom: 8px;
            margin-top: 30px;
            font-size: 1.6em;
            font-weight: 600;
            opacity: 0.9;
        }
        
        h3 {
             color: var(--ios-active-color);
             font-weight: 600;
             opacity: 0.9;
        }

        /* --- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä (–ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è) --- */
        #game-container {
            max-width: 980px;
            width: 100%;
            margin: 0 auto;
            background: rgba(0, 0, 0, 0.4); 
            backdrop-filter: blur(var(--ios-blur-strength));
            border: 1px solid var(--ios-module-border);
            padding: 30px;
            border-radius: 40px; 
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.7); 
            overflow: hidden; 
            position: relative; /* –î–ª—è –Ω–∞–ª–æ–∂–µ–Ω–∏—è –æ–≤–µ—Ä–ª–µ—è */
        }

        .phase-section {
            padding: 20px;
            background: var(--ios-module-bg); 
            backdrop-filter: blur(calc(var(--ios-blur-strength) / 2)); 
            border-radius: 28px; 
            margin-bottom: 20px;
            border: 1px solid var(--ios-module-border);
            text-align: left;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3); 
        }

        /* --- –û–≤–µ—Ä–ª–µ–π –ü–µ—Ä–µ—Ö–æ–¥–∞ –•–æ–¥–∞ (–ù–æ–≤—ã–π –≠–ª–µ–º–µ–Ω—Ç) --- */
        #turn-transition-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(5px);
            display: none; /* –°–∫—Ä—ã—Ç –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é */
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.5s ease-in-out;
            text-align: center;
        }
        #turn-transition-overlay.show {
            display: flex;
            opacity: 1;
        }

        #overlay-text {
            font-size: 4em;
            font-weight: 800;
            color: var(--ios-text-color);
            text-shadow: 0 0 20px var(--ios-active-color);
            animation: pulse 1.5s infinite alternate;
            padding: 20px;
            border-radius: 15px;
            background: rgba(0, 132, 255, 0.1);
            line-height: 1.2;
        }

        @keyframes pulse {
            from {
                transform: scale(1);
                opacity: 0.9;
            }
            to {
                transform: scale(1.05);
                opacity: 1;
            }
        }
        
        /* --- –ö–Ω–æ–ø–∫–∏ (–ò–º–∏—Ç–∞—Ü–∏—è –º–æ–¥—É–ª–µ–π iOS) --- */
        .btn-primary {
            background-color: var(--ios-active-color);
            color: var(--ios-text-color);
            border: none;
            padding: 18px 35px; 
            font-size: 1.15em;
            font-weight: 600;
            border-radius: 20px; 
            cursor: pointer;
            margin: 15px 10px;
            transition: background-color 0.2s, box-shadow 0.2s, transform 0.1s, opacity 0.2s;
            box-shadow: 0 5px 15px rgba(0, 132, 255, 0.3); 
            opacity: 0.9;
        }

        .btn-primary:hover:not(:disabled) {
            background-color: #38a5ff;
            box-shadow: 0 8px 25px rgba(0, 132, 255, 0.5);
            transform: translateY(-3px);
            opacity: 1;
        }

        .btn-primary:disabled {
            background: rgba(255, 255, 255, 0.05); 
            color: rgba(255, 255, 255, 0.3);
            cursor: not-allowed;
            box-shadow: none;
            transform: none;
            opacity: 0.6;
        }
        
        /* --- –¢–∞–π–º–µ—Ä --- */
        .timer-module {
            background: var(--ios-module-bg);
            backdrop-filter: blur(calc(var(--ios-blur-strength) / 2));
            border-radius: 28px;
            border: 1px solid var(--ios-module-border);
            padding: 15px 25px;
            margin: 20px auto;
            display: inline-flex; 
            align-items: center;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            width: fit-content;
        }
        
        .timer-module .icon {
            font-size: 2.2em; 
            margin-right: 15px;
            color: rgba(255, 255, 255, 0.7);
        }

        #timer-display {
            font-size: 2.8em;
            font-weight: 700;
            color: var(--ios-text-color);
            opacity: 0.9;
            text-shadow: 0 0 8px rgba(255, 255, 255, 0.2);
        }
        
        /* --- –ù–∞—Å—Ç—Ä–æ–π–∫–∏: –û–±—â–∏–µ —Å—Ç–∏–ª–∏ –¥–ª—è —Å–µ—Ç–∫–∏ --- */
        .settings-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }
        .settings-grid-3 {
            grid-template-columns: 1fr 1fr 1fr;
        }

        .setting-item {
            background: rgba(255, 255, 255, 0.08);
            border-radius: 18px;
            padding: 20px;
            text-align: center;
        }

        .setting-item label {
            display: block;
            font-size: 1.1em;
            font-weight: 600;
            margin-bottom: 10px;
            color: var(--ios-active-color);
        }
        
        .setting-item .value-display {
            font-size: 2em;
            font-weight: 700;
            color: var(--ios-text-color);
            margin-bottom: 15px;
        }
        
        /* --- Input Names --- */
        #player-names-input {
            margin-top: 20px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
        }
        #player-names-input input {
            padding: 10px;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.15);
            background: rgba(0, 0, 0, 0.3);
            color: var(--ios-text-color);
            font-size: 1em;
            text-align: center;
        }
        
        /* --- –ù–∞—Å—Ç—Ä–æ–π–∫–∏: –í–∞—Ä–∏–∞–Ω—Ç—ã –∏–≥—Ä—ã (Radio buttons) --- */
        #game-variant-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
        }
        
        .variant-option {
            padding: 18px;
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.05);
            border-radius: 18px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
            cursor: pointer;
            transition: background-color 0.2s;
            display: flex;
            align-items: center;
        }

        .variant-option:hover {
            background: rgba(255, 255, 255, 0.15);
        }

        .variant-option label {
            font-weight: 500;
            cursor: pointer;
            opacity: 0.9;
            color: var(--ios-text-color); 
            margin: 0;
            font-size: 1em;
            flex-grow: 1;
        }

        .variant-option input[type="radio"] {
            margin-right: 10px;
            appearance: none; 
            width: 20px;
            height: 20px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            background-color: rgba(255, 255, 255, 0.1);
            position: relative;
            vertical-align: middle;
            cursor: pointer;
            transition: background-color 0.2s, border-color 0.2s;
            flex-shrink: 0;
        }
        .variant-option input[type="radio"]:checked {
            background-color: var(--ios-active-color);
            border-color: var(--ios-active-color);
            box-shadow: 0 0 0 2px rgba(0, 132, 255, 0.3);
        }
        .variant-option input[type="radio"]:checked::after {
            content: '';
            width: 10px;
            height: 10px;
            background-color: white;
            border-radius: 50%;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        /* --- –°—Ç–∏–ª–∏–∑–∞—Ü–∏—è –ø–æ–ª–∑—É–Ω–∫–∞ (Slider) --- */
        input[type="range"] {
            -webkit-appearance: none;
            width: 100%;
            height: 10px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 5px;
            margin: 0;
            cursor: pointer;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            background: var(--ios-active-color);
            cursor: pointer;
            box-shadow: 0 0 5px rgba(0, 132, 255, 0.6);
            transition: background 0.2s;
        }
        
        /* --- –ß–ï–ö-–õ–ò–°–¢ (–û–§–ò–¶–ò–ê–õ–¨–ù–ê–Ø –°–¢–†–£–ö–¢–£–†–ê) --- */
        .checklist-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 20px;
            text-align: left;
        }
        .checklist-item label { 
            font-size: 1.05em; 
            color: var(--ios-text-color);
            opacity: 0.9;
        }
        
        .checklist-item textarea {
            width: 100%;
            height: 90px;
            padding: 10px;
            margin-top: 5px;
            box-sizing: border-box;
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 14px;
            background: rgba(0, 0, 0, 0.3); 
            color: var(--ios-text-color);
            font-family: inherit;
            font-size: 0.95em;
            resize: vertical;
        }
        
        /* --- –°–µ–∫—Ü–∏—è –û—Ü–µ–Ω–∫–∏ (Scoring) --- */
        .score-option {
            display: flex;
            align-items: center;
            padding: 10px 0;
            font-size: 1.05em;
        }
        .score-option input[type="checkbox"],
        .score-option input[type="radio"] {
            margin-right: 15px;
            width: 20px;
            height: 20px;
            flex-shrink: 0;
            cursor: pointer;
        }
        .score-option label {
            cursor: pointer;
        }
        
        /* --- –ö–∞—Ä—Ç–æ—á–∫–∏ --- */
        #card-display {
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); 
            gap: 15px;
        }

        .card {
            min-height: 180px; 
            border-radius: 20px;
            padding: 20px;
            color: var(--ios-text-color);
            background: rgba(255, 255, 255, 0.08); 
            backdrop-filter: blur(calc(var(--ios-blur-strength) / 3)); 
            border: 1px solid rgba(255, 255, 255, 0.05);
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            text-align: left;
            font-size: 0.95em;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            opacity: 0.9;
        }
        
        /* –£–≤–µ–ª–∏—á–µ–Ω–∏–µ –∏ –≤—ã–¥–µ–ª–µ–Ω–∏–µ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞ –∫–∞—Ä—Ç–æ—á–∫–∏ */
        .card .card-content {
            font-size: 1.25em; /* –£–≤–µ–ª–∏—á–µ–Ω–∏–µ */
            font-weight: 700;
            margin-top: 10px;
        }
        
        .card-problem .card-title::before { content: '‚ö†Ô∏è '; color: var(--ios-red); }
        .card-audience .card-title::before { content: 'üë• '; color: var(--ios-active-color); }
        .card-condition .card-title::before { content: '‚öôÔ∏è '; color: var(--ios-orange); }
        .card-technology .card-title::before { content: 'üí° '; color: var(--ios-green); }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö */
        .submitted-data-value {
            margin: 5px 0 0; 
            background: rgba(255, 255, 255, 0.05); 
            padding: 10px; 
            border-radius: 8px; 
            border: 1px solid var(--ios-module-border); 
            min-height: 40px; 
            opacity: 0.9;
        }
        
        /* –¢–∞–±–ª–∏—Ü–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ */
        #scoreboard, #final-ranking {
            width: 100%;
            border-collapse: separate; 
            border-spacing: 0 10px; 
            margin-top: 20px;
            text-align: left;
        }
        #scoreboard th, #scoreboard td, 
        #final-ranking th, #final-ranking td {
            padding: 12px;
            border-radius: 12px; 
        }
        #scoreboard th, #final-ranking th {
            background: var(--ios-active-color);
            color: var(--ios-text-color);
            font-weight: 600;
            opacity: 0.8;
            position: sticky; 
            top: 0;
            z-index: 10;
        }
        #scoreboard td, #final-ranking td {
            background: rgba(255, 255, 255, 0.05);
            border-left: 1px solid var(--ios-module-border);
            border-right: 1px solid var(--ios-module-border);
        }
        #scoreboard td:first-child, #final-ranking td:first-child {
            font-weight: 700;
            border-left: none;
            background: rgba(255, 255, 255, 0.1);
            border-top-left-radius: 12px;
            border-bottom-left-radius: 12px;
        }
        #scoreboard td:last-child, #final-ranking td:last-child {
            font-weight: 700;
            color: var(--ios-green);
            background: rgba(52, 199, 89, 0.1);
            border-right: none;
            border-top-right-radius: 12px;
            border-bottom-right-radius: 12px;
        }
        
        /* –°—Ç–∏–ª—å –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ –∏–≥—Ä–æ–∫–∞ –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ –æ—Ü–µ–Ω–∫–∏ */
        .player-name-style {
            color: var(--ios-orange);
            font-weight: 700;
            font-size: 1.1em;
        }

        /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
        @media (max-width: 900px) {
            #game-variant-options {
                grid-template-columns: 1fr 1fr; 
            }
        }

        @media (max-width: 650px) {
            #game-variant-options {
                grid-template-columns: 1fr; 
            }
            .settings-grid {
                grid-template-columns: 1fr;
            }
            .checklist-grid {
                grid-template-columns: 1fr; 
            }
            .settings-grid-3 {
                grid-template-columns: 1fr;
            }
            #overlay-text {
                font-size: 3em;
            }
        }
    </style>
</head>
<body>
    
    <div id="turn-transition-overlay">
        <div id="overlay-text">–•–û–î: <br>–ò–ú–Ø –ò–ì–†–û–ö–ê</div>
    </div>
    
    <div id="game-container">
        <h1>–°—Ç–∞—Ä—Ç–∞–ø-–ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä <span style="opacity: 0.6; font-size: 0.7em;">(iOS Edition)</span></h1>
        
        <div id="start-phase">
            <h2>‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∏–≥—Ä—ã</h2>
            
            <div class="phase-section" style="text-align: left;">
                
                <h3 style="margin-bottom: 15px;">üéÆ –†–µ–∂–∏–º –∏ –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å</h3>
                <div id="game-variant-options">
                    <div class="variant-option">
                        <input type="radio" name="game-variant" id="variant-express" value="3" checked>
                        <label for="variant-express">–≠–∫—Å–ø—Ä–µ—Å—Å –∏–≥—Ä–∞ (3 –º–∏–Ω)</label>
                    </div>
                    <div class="variant-option">
                        <input type="radio" name="game-variant" id="variant-basic" value="15">
                        <label for="variant-basic">–ë–∞–∑–æ–≤—ã–π –≤–∞—Ä–∏–∞–Ω—Ç (15 –º–∏–Ω)</label>
                    </div>
                    <div class="variant-option">
                        <input type="radio" name="game-variant" id="variant-complex" value="30">
                        <label for="variant-complex">–ö–æ–º–ø–ª–µ–∫—Å–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç (30 –º–∏–Ω)</label>
                    </div>
                    <div class="variant-option">
                        <input type="radio" name="game-variant" id="variant-pro" value="45">
                        <label for="variant-pro">–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç (45 –º–∏–Ω)</label>
                    </div>
                </div>
                
                <h3 style="margin-top: 30px; margin-bottom: 15px;">‚öôÔ∏è –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ò–≥—Ä—ã</h3>
                <div class="settings-grid settings-grid-3">
                    <div class="setting-item">
                        <label for="time-slider">‚è∞ –í—Ä–µ–º—è –Ω–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏—é (–º–∏–Ω)</label>
                        <div class="value-display" id="time-display">3</div>
                        <input type="range" id="time-slider" min="1" max="120" value="3" step="1">
                    </div>
                    
                    <div class="setting-item">
                        <label for="player-slider">üë• –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏–≥—Ä–æ–∫–æ–≤/–∫–æ–º–∞–Ω–¥</label>
                        <div class="value-display" id="player-display">1</div>
                        <input type="range" id="player-slider" min="1" max="15" value="1" step="1">
                    </div>
                    
                    <div class="setting-item">
                        <label for="rounds-slider">üîÑ –í—Å–µ–≥–æ —Ä–∞—É–Ω–¥–æ–≤</label>
                        <div class="value-display" id="rounds-display">1</div>
                        <input type="range" id="rounds-slider" min="1" max="5" value="1" step="1">
                    </div>
                </div>
                
                <h3 style="margin-top: 30px; margin-bottom: 15px;">‚úçÔ∏è –ò–º–µ–Ω–∞ –∏–≥—Ä–æ–∫–æ–≤/–∫–æ–º–∞–Ω–¥</h3>
                <div id="player-names-input">
                    </div>
            </div>
            
            <p style="opacity: 0.7;">–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –∏–≥—Ä—É –∏ –Ω–∞–∂–º–∏—Ç–µ "–ù–∞—á–∞—Ç—å –ü—Ä–æ–µ–∫—Ç" –¥–ª—è —Å—Ç–∞—Ä—Ç–∞.</p>
            <button id="start-game-btn" class="btn-primary">‚ñ∂Ô∏è –ù–∞—á–∞—Ç—å –ü—Ä–æ–µ–∫—Ç</button>
        </div>

        <div id="generation-phase" style="display: none;">
            <h2 id="round-and-player-header">–†–∞—É–Ω–¥ 1 | –ò–≥—Ä–æ–∫: <span class="player-name-style">–ò–≥—Ä–æ–∫ 1</span></h2> 
            <h2>–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –ü—Ä–æ–µ–∫—Ç—É</h2>
            <div id="card-display" class="phase-section" style="text-align: center;">
                </div>
            
            <div style="margin-top: 30px; text-align: center;">
                <h2>‚è±Ô∏è –û—Å—Ç–∞–≤—à–µ–µ—Å—è –≤—Ä–µ–º—è</h2>
                <div class="timer-module">
                    <span class="icon">‚è∞</span>
                    <span id="timer-display">03:00</span>
                </div>
            </div>
            
            <div class="phase-section">
                <h3>üìù –ß–ï–ö-–õ–ò–°–¢ –ë–∏–∑–Ω–µ—Å-–∏–¥–µ–∏</h3>
                <p style="font-size: 0.9em; opacity: 0.7;">–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –ø–æ–ª—è –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å –ß–µ–∫-–ª–∏—Å—Ç–æ–º –∏ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º–∏ –≤—ã–ø–∞–≤—à–∏—Ö –∫–∞—Ä—Ç. –ò–Ω—Ç–µ–≥—Ä–∏—Ä—É–π—Ç–µ 4 –∫–∞—Ä—Ç—ã –¥–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ –±–æ–Ω—É—Å–∞.</p>
                
                <div class="checklist-grid">
                    
                    <div class="checklist-item">
                        <label for="input-problem">–ü—Ä–æ–±–ª–µ–º–∞</label>
                        <textarea id="input-problem" placeholder="–û–ø–∏—à–∏—Ç–µ, –∫–∞–∫ –≤–∞—à–∞ –∏–¥–µ—è —Ä–µ—à–∞–µ—Ç –≤—ã–ø–∞–≤—à—É—é –ü—Ä–æ–±–ª–µ–º—É (–ö–∞—Ä—Ç–∞ 1)."></textarea>
                    </div>
                    <div class="checklist-item">
                        <label for="input-solution">–†–µ—à–µ–Ω–∏–µ</label>
                        <textarea id="input-solution" placeholder="–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –≤–∞—à–µ–≥–æ –ø—Ä–æ–¥—É–∫—Ç–∞ –∏–ª–∏ —É—Å–ª—É–≥–∏."></textarea>
                    </div>

                    <div class="checklist-item">
                        <label for="input-audience">–ö—Ç–æ –∫–ª–∏–µ–Ω—Ç—ã (–¶–ê), —Å–∫–æ–ª—å–∫–æ –∏—Ö?</label>
                        <textarea id="input-audience" placeholder="–ö—Ç–æ –≤–∞—à–∞ –¶–µ–ª–µ–≤–∞—è –ê—É–¥–∏—Ç–æ—Ä–∏—è (–ö–∞—Ä—Ç–∞ 2)?"></textarea>
                    </div>
                    <div class="checklist-item">
                        <label for="input-product-look">–ö–∞–∫ –≤—ã–≥–ª—è–¥–∏—Ç –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–æ–¥—É–∫—Ç?</label>
                        <textarea id="input-product-look" placeholder="–û–ø–∏—à–∏—Ç–µ, –∫–∞–∫ –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è (–ö–∞—Ä—Ç–∞ 4) –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–∞ –≤ –ø—Ä–æ–¥—É–∫—Ç."></textarea>
                    </div>
                    
                    <div class="checklist-item">
                        <label for="input-current-solution">–ö–∞–∫ –æ–Ω–∏ —Ä–µ—à–∞—é—Ç –ø—Ä–æ–±–ª–µ–º—É —Å–µ–π—á–∞—Å?</label>
                        <textarea id="input-current-solution" placeholder="–ö–∞–∫ –∫–ª–∏–µ–Ω—Ç—ã —Ä–µ—à–∞—é—Ç –ø—Ä–æ–±–ª–µ–º—É —Å–µ–π—á–∞—Å (–ö–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ)?"></textarea>
                    </div>
                    <div class="checklist-item">
                        <label for="input-advantage">–í —á—ë–º –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–æ?</label>
                        <textarea id="input-advantage" placeholder="–í —á—ë–º –≤–∞—à–µ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–æ, —É—á–∏—Ç—ã–≤–∞—è –î–æ–ø—É—Å–ª–æ–≤–∏–µ (–ö–∞—Ä—Ç–∞ 3)?"></textarea>
                    </div>
                    
                </div>
                
                <div style="text-align: center;">
                    <button id="submit-turn-btn" class="btn-primary" disabled>üîÑ –ü—Ä–æ–µ–∫—Ç –≥–æ—Ç–æ–≤ (–ü–µ—Ä–µ–¥–∞—Ç—å —Ö–æ–¥)</button> 
                    <p id="timer-message" style="color: var(--ios-active-color); font-weight: 500; opacity: 0.8;"></p>
                </div>
            </div>
        </div>

        <div id="scoring-phase" style="display: none;">
            <h2 id="scoring-header">–û—Ü–µ–Ω–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞ <span class="player-name-style">–ò–≥—Ä–æ–∫ 1</span> (–†–∞—É–Ω–¥ <span id="current-round-display">1</span>)</h2>
            
            <div class="phase-section" id="leaderboard-container">
                <h3>üìä –¢–µ–∫—É—â–∏–π —Å—á–µ—Ç</h3>
                <div style="overflow-x: auto;">
                    <table id="scoreboard">
                        </table>
                </div>
            </div>
            
            <div id="submitted-summary-container" class="phase-section" style="text-align: left; margin-top: 20px;">
                <h3 style="color: var(--ios-green);">üìù –ó–∞–ø–æ–ª–Ω–µ–Ω–Ω–∞—è –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ò–≥—Ä–æ–∫–∞</h3>
                <div id="submitted-summary-data" class="checklist-grid" style="font-size: 0.9em;">
                    </div>
            </div>
            
            <div class="phase-section" id="scoring-options">
                <h3>1. –û—Å–Ω–æ–≤–Ω–æ–π –±–∞–ª–ª (–ú–∞–∫—Å 2)</h3>
                <p style="opacity: 0.7;">–û—Ü–µ–Ω–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç, –∫–æ—Ç–æ—Ä—ã–π –≤—ã —Ç–æ–ª—å–∫–æ —á—Ç–æ —É–≤–∏–¥–µ–ª–∏:</p>
                <div class="score-option">
                    <input type="checkbox" id="score-idea">
                    <label for="score-idea">–ü—Ä–æ–µ–∫—Ç –±—ã–ª —Å–∏–ª—å–Ω—ã–º –∏ —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω—ã–º (–õ—É—á—à–∞—è –±–∏–∑–Ω–µ—Å-–∏–¥–µ—è). (+1 –æ—á–∫–æ)</label>
                </div>
                <div class="score-option">
                    <input type="checkbox" id="score-presentation">
                    <label for="score-presentation">–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è/–ü—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏—è –±—ã–ª–∞ —á–µ—Ç–∫–æ–π –∏ —É–±–µ–¥–∏—Ç–µ–ª—å–Ω–æ–π (–ò–Ω—Ç–µ—Ä–µ—Å–Ω–∞—è –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏—è). (+1 –æ—á–∫–æ)</label>
                </div>
                
                <h3>2. –ë–æ–Ω—É—Å –∑–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é (–ú–∞–∫—Å 2)</h3>
                <p style="opacity: 0.7;">–í—ã–±–µ—Ä–∏—Ç–µ, —Å–∫–æ–ª—å–∫–æ –∏–∑ 4 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–Ω—ã—Ö —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π (–∫–∞—Ä—Ç) –±—ã–ª–æ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–æ –≤ –∏–¥–µ—é:</p>
                <div class="score-option">
                    <input type="radio" name="card-usage" id="usage-4" value="2">
                    <label for="usage-4">–ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–æ 4 —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è. (+2 –æ—á–∫–∞)</label>
                </div>
                <div class="score-option">
                    <input type="radio" name="card-usage" id="usage-3" value="1">
                    <label for="usage-3">–ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–æ 3 —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è. (+1 –æ—á–∫–æ)</label>
                </div>
                <div class="score-option">
                    <input type="radio" name="card-usage" id="usage-0" value="0" checked>
                    <label for="usage-0">–ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–æ 2 –∏–ª–∏ –º–µ–Ω—å—à–µ. (+0 –æ—á–∫–æ–≤)</label>
                </div>
            </div>
            
            <div style="text-align: center;">
                <button id="confirm-score-btn" class="btn-primary">‚ú® –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –û—Ü–µ–Ω–∫—É</button>
            </div>
        </div>
        
        <div id="final-results-phase" style="display: none;">
            <h2>üèÜ –§–ò–ù–ê–õ–¨–ù–´–ï –†–ï–ó–£–õ–¨–¢–ê–¢–´ –ò–ì–†–´</h2>
            <div class="phase-section">
                <table id="final-ranking">
                    </table>
            </div>
            <div style="text-align: center;">
                <button id="restart-game-btn" class="btn-primary">üîÑ –ù–∞—á–∞—Ç—å –Ω–æ–≤—É—é –∏–≥—Ä—É</button>
            </div>
        </div>
    </div>
    
    <script>
        // --- 1. –î–∞–Ω–Ω—ã–µ –¥–ª—è –∫–∞—Ä—Ç ---
        const audiences = [
            "–†–æ–¥–∏—Ç–µ–ª–∏ –¥–µ—Ç–µ–π –¥–æ 5 –ª–µ—Ç", "–ê–≤—Ç–æ–º–æ–±–∏–ª–∏—Å—Ç—ã", "–•—É–¥–µ—é—â–∏–µ", 
            "–ö–∏–±–µ—Ä—Å–ø–æ—Ä—Å–º–µ–Ω—ã", "–§–µ—Ä–º–µ—Ä—ã", "–ú–æ—Ä—è–∫–∏", "–í–ª–∞–¥–µ–ª—å—Ü—ã —Å–æ–±–∞–∫", 
            "–®–∫–æ–ª—å–Ω–∏–∫–∏ –∏ –°—Ç—É–¥–µ–Ω—Ç—ã", "–û–¥–∏–Ω–æ–∫–∏–µ –ª—é–¥–∏", "–ó–∞–±—ã–≤—á–∏–≤—ã–µ –ª—é–¥–∏", 
            "–°–ø–æ—Ä—Ç—Å–º–µ–Ω—ã –∏ –ó–û–ñ", "–ü–µ–Ω—Å–∏–æ–Ω–µ—Ä—ã", "–£–ø—Ä–∞–≤–ª—è—é—â–∏–µ", "–ë–ª–æ–≥–µ—Ä—ã", 
            "–õ—é–±–∏—Ç–µ–ª–∏ –≥–∞–¥–∂–µ—Ç–æ–≤", "–õ—é–±–∏—Ç–µ–ª–∏ –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω—ã—Ö —Ä–∞–∑–≤–ª–µ—á–µ–Ω–∏–π", 
            "–ö—É—Ä—å–µ—Ä—ã", "–¢—É—Ä–∏—Å—Ç—ã", "–°–ø–∞—Å–∞—Ç–µ–ª–∏", "–ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª–∏"
        ];

        const conditions = [
            "–í–µ–Ω–¥–∏–Ω–≥–æ–≤—ã–π –∞–ø–ø–∞—Ä–∞—Ç", "–í–∞–Ω–Ω–∞—è –∫–æ–º–Ω–∞—Ç–∞", "–°–µ—Ä–≤–∏—Å –ø–æ –ø–æ–¥–ø–∏—Å–∫–µ", 
            "–°–ø–æ—Ä—Ç–∏–≤–Ω–æ–µ —Å–æ–æ—Ä—É–∂–µ–Ω–∏—è", "–ë–∞—Ä—Ç–µ—Ä –Ω–∞ —É—Å–ª—É–≥–∏, —Ç–æ–≤–∞—Ä—ã, –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏", 
            "–ü–æ—Ö–æ–¥, —ç–∫—Å–ø–µ–¥–∏—Ü–∏—è", "–®–µ—Ä–∏–Ω–≥- –∞—Ä–µ–Ω–¥–∞ —Å–∞–º–æ–æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è", 
            "–£—Å–ª–æ–≤–Ω–æ-–±–µ—Å–ø–ª–∞—Ç–Ω–æ –¥–ª—è –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—è", "–ü–∞—Ä–∫ —Ä–∞–∑–≤–ª–µ—á–µ–Ω–∏—è –∞—Ç—Ç–∞–∫—Ü–∏–æ–Ω—ã", 
            "–û–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω–æ–µ —É—á—Ä–µ–∂–¥–µ–Ω–∏–µ", "–ù–∞–±–µ—Ä–µ–∂–Ω–∞—è –ø–ª—è–∂", "–ê—ç—Ä–æ–ø–æ—Ä—Ç, —Å–∞–º–æ–ª—ë—Ç", 
            "–ê—Ä–µ–Ω–¥–∞", "–°—É–ø–µ—Ä–º–∞—Ä–∫–µ—Ç", "–°–∫–ª–∞–¥, –•—Ä–∞–Ω–∏–ª–∏—â–µ", "–ú–µ–¥–∏—Ü–∏–Ω—Å–∫–æ–µ —É—á—Ä–µ–∂–¥–µ–Ω–∏–µ", 
            "–õ–µ—Å, –ø–∞—Ä–∫, —Å–∫–≤–µ—Ä", "–ö–∞—Ñ–µ, —Ä–µ—Å—Ç–æ—Ä–∞–Ω", "–ú–æ–±–∏–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ", "–ì–æ—Å—Ç–∏–Ω–∏—Ü–∞"
        ];

        const technologies = [
            "–ë–∏–æ—Ä–∞–∑–ª–∞–≥–∞–µ–º—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã", "–ù–µ–π—Ä–æ—Å–µ—Ç–∏ –∏ –∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω—ã–π –∏–Ω—Ç–µ–ª–µ–∫—Ç", 
            "–ë–µ—Å–ø—Ä–æ–≤–æ–¥–Ω—ã–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã (wifi,4g,Bluetooth,NFC)", "–°–≤–µ—Ä—Ö–≥–∏–±–∫–∏–µ —ç–∫—Ä–∞–Ω—ã", 
            "–ú–∏–∫—Ä–æ–±–æ—Ç—ã", "–ú–≥–Ω–æ–≤–µ–Ω–Ω–∞—è –≥–ª—É–±–æ–∫–∞—è –∑–∞–º–æ—Ä–æ–∑–∫–∞ –∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ", 
            "–°–æ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–µ—Ç–∏", "–ì–æ–ª–æ–≥—Ä–∞–º–º—ã", "–°–∞–º–æ—É–ø—Ä–∞–≤–ª—è–µ–º—ã–π —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç", 
            "–í–∏—Ä—Ç—É–∞–ª—å–Ω–∞—è —Ä–µ–∞–ª—å–Ω–æ—Å—Ç—å", "3–î-–ø–µ—á–∞—Ç—å –∏ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ", 
            "–ì–æ–ª–æ—Å–æ–≤–æ–π –ø–æ–º–æ—â–Ω–∏–∫", "–ì–µ–Ω–Ω–Ω–∞—è –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏—è", 
            "–°–ø—É—Ç–Ω–∏–∫–æ–≤—ã–µ —Ñ–æ—Ç–æ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏", "–ù–µ–π—Ä–æ–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã", 
            "–ù–∞–Ω–æ–ø–æ–∫—Ä—ã—Ç–∏—è", "–î–æ–ø–æ–ª–Ω–µ–Ω–Ω–∞—è —Ä–µ–∞–ª—å–Ω–æ—Å—Ç—å", "–î—Ä–æ–Ω—ã", 
            "–ë–∏–æ–º–µ—Ç—Ä–∏—è", "–ò–Ω—Ç–µ—Ä–Ω–µ—Ç –≤–µ—â–µ–π"
        ];

        const problems = [
            "–ü–∏—Ç–∞–Ω–∏–µ", "–ü–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç—å –≤—ã–≥–ª—è–¥–µ—Ç—å –ª—É—á—à–µ", "–ú–∞–ª–æ –ø–∞—Ä–∫–æ–≤–æ—á–Ω—ã—Ö –º–µ—Å—Ç", 
            "–£—Å—Ç–∞–ª–æ—Å—Ç—å –∏ —Å—Ç—Ä–µ—Å—Å –Ω–∞ —Ä–∞–±–æ—Ç–µ", "–ü—Ä–æ–±–ª–µ–º–∞ –≤—ã–±–æ—Ä–∞ —Ç–æ–≤–∞—Ä–∞ –∏ —É—Å—Ç—É–≥", 
            "–û–±—â–µ–Ω–∏–µ —Å –ª—é–¥—å–º–∏", "–ì–∏–ø–æ–¥–∏–Ω–∞–º–∏—è", "–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç", 
            "–ñ–µ–ª–∞–Ω–∏–µ –¥–µ–ª–∞—Ç—å –º–∏—Ä –ª—É—á—à–µ", "–ó–∞–º—É—Å–æ—Ä–∏–≤–∞–Ω–∏–µ", "–°–∫—É–∫–∞", 
            "–ü–ª–æ—Ö–∞—è –ø–æ–≥–æ–¥–∞", "–ù–µ—Ö–≤–∞—Ç–∫–∞ –≤—Ä–µ–º–µ–Ω–∏", "–•–æ–ª–æ–¥", 
            "–ù–µ–∑–Ω–∞–Ω–∏–µ –∏–Ω–æ—Å—Ç—Ä–∞–Ω–Ω—ã—Ö —è–∑—ã–∫–æ–≤", "–ö—Ä–∏–º–∏–Ω–∞–ª—å–Ω–∞—è –æ–ø–∞—Å–Ω–æ—Å—Ç—å", 
            "–†–µ–º–æ–Ω—Ç –≤ –∫–≤–∞—Ä—Ç–∏—Ä–µ, —á–∞—Å—Ç–Ω–æ–º –¥–æ–º–µ", "–ñ–∞–∂–¥–∞ –Ω–æ–≤—ã—Ö –æ—â—É—â–µ–Ω–∏–π", 
            "–§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –∑–∞—Ç—Ä—É–¥–Ω–µ–Ω–∏—è", "–ó–∞–≥—Ä—è–∑–Ω–µ–Ω–∏–µ –≤–æ–¥—ã –∏ –≤–æ–∑–¥—É—Ö–∞"
        ];
        
        // –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ ID –ø–æ–ª–µ–π –ß–µ–∫-–ª–∏—Å—Ç–∞ –∏—Ö –∑–∞–≥–æ–ª–æ–≤–∫–∞–º
        const checklistFields = {
            'input-problem': '–ü—Ä–æ–±–ª–µ–º–∞',
            'input-solution': '–†–µ—à–µ–Ω–∏–µ',
            'input-audience': '–ö—Ç–æ –∫–ª–∏–µ–Ω—Ç—ã (–¶–ê), —Å–∫–æ–ª—å–∫–æ –∏—Ö?',
            'input-product-look': '–ö–∞–∫ –≤—ã–≥–ª—è–¥–∏—Ç –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–æ–¥—É–∫—Ç?',
            'input-current-solution': '–ö–∞–∫ –æ–Ω–∏ —Ä–µ—à–∞—é—Ç –ø—Ä–æ–±–ª–µ–º—É —Å–µ–π—á–∞—Å?',
            'input-advantage': '–í —á—ë–º –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–æ?'
        };
        
        // ‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –ú–∞—Å—Å–∏–≤ ID –¥–ª—è –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –æ—á–∏—Å—Ç–∫–∏ –ø–æ–ª–µ–π
        const generationInputIds = Object.keys(checklistFields); 

        // --- 2. –ö–ª–∞—Å—Å –∏ –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –°–æ—Å—Ç–æ—è–Ω–∏—è –ò–≥—Ä—ã ---
        
        class Player {
            constructor(name) {
                this.name = name;
                this.score = 0;
                this.roundScores = []; 
                this.ideaData = []; // [{round: 1, cards: {...}, checklist: {...}}, ...]
            }
            addScore(points) {
                this.score += points;
                this.roundScores.push(points);
            }
            // –°–±—Ä–æ—Å –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –Ω–æ–≤–æ–π –∏–≥—Ä—ã
            reset() {
                this.score = 0;
                this.roundScores = [];
                this.ideaData = [];
            }
        }
        
        let players = [];
        let currentPlayerIndex = 0; 
        let currentRound = 1;
        let totalRounds = 1;
        let countdownInterval;
        let selectedTimeInMinutes = 3; 
        
        // --- –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∫–∞—Ä—Ç —Ç–µ–∫—É—â–µ–≥–æ —Ä–∞—É–Ω–¥–∞/–∏–≥—Ä–æ–∫–∞ ---
        let currentCards = {}; 
        let scoringPlayerIndex = 0; 

        // --- 3. DOM-—ç–ª–µ–º–µ–Ω—Ç—ã ---
        const startPhase = document.getElementById('start-phase');
        const generationPhase = document.getElementById('generation-phase');
        const scoringPhase = document.getElementById('scoring-phase');
        const finalResultsPhase = document.getElementById('final-results-phase');
        const cardDisplay = document.getElementById('card-display');
        const timerDisplay = document.getElementById('timer-display');
        const submitTurnBtn = document.getElementById('submit-turn-btn'); 
        const confirmScoreBtn = document.getElementById('confirm-score-btn'); 
        const timerMessage = document.getElementById('timer-message');
        const submittedSummaryData = document.getElementById('submitted-summary-data');
        const scoreboardTable = document.getElementById('scoreboard');
        const finalRankingTable = document.getElementById('final-ranking');
        const turnOverlay = document.getElementById('turn-transition-overlay');
        const overlayText = document.getElementById('overlay-text');
        
        // –≠–ª–µ–º–µ–Ω—Ç—ã –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ (–¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è)
        const roundAndPlayerHeader = document.getElementById('round-and-player-header');
        const scoringHeader = document.getElementById('scoring-header');


        // –≠–ª–µ–º–µ–Ω—Ç—ã –Ω–∞—Å—Ç—Ä–æ–µ–∫
        const timeSlider = document.getElementById('time-slider');
        const timeDisplay = document.getElementById('time-display');
        const playerSlider = document.getElementById('player-slider');
        const playerDisplay = document.getElementById('player-display');
        const roundsSlider = document.getElementById('rounds-slider');
        const roundsDisplay = document.getElementById('rounds-display');
        const gameVariantOptions = document.getElementsByName('game-variant');
        const playerNameInputContainer = document.getElementById('player-names-input');
        
        // --- 4. –§—É–Ω–∫—Ü–∏–∏ –ö–∞—Ä—Ç–æ—á–µ–∫ –∏ –ì–µ–Ω–µ—Ä–∞—Ü–∏–∏ ---
        function getRandomCard(array) {
            const randomIndex = Math.floor(Math.random() * array.length);
            return array[randomIndex];
        }

        function createCardElement(title, text, cssClass) {
            const cardDiv = document.createElement('div');
            cardDiv.className = `card ${cssClass}`;
            cardDiv.innerHTML = `<div class="card-title" style="font-weight: 700; font-size: 1.1em; margin-bottom: 5px;">${title}</div><p class="card-content" style="margin: 0; opacity: 0.9;">${text}</p>`;
            cardDisplay.appendChild(cardDiv);
            return text; 
        }
        
        function drawCards() {
            cardDisplay.innerHTML = '';
            
            // –†–∞–∑–¥–∞—á–∞ 4 —Å–ª—É—á–∞–π–Ω—ã—Ö –∫–∞—Ä—Ç –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏—Ö —Ç–µ–∫—Å—Ç–∞ –≤ currentCards
            currentCards = {
                problem: createCardElement("–°–∏—Ç—É–∞—Ü–∏—è/–ü—Ä–æ–±–ª–µ–º–∞", getRandomCard(problems), 'card-problem'),
                audience: createCardElement("–¶–µ–ª–µ–≤–∞—è –ê—É–¥–∏—Ç–æ—Ä–∏—è", getRandomCard(audiences), 'card-audience'),
                condition: createCardElement("–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ –£—Å–ª–æ–≤–∏–µ", getRandomCard(conditions), 'card-condition'),
                technology: createCardElement("–¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è", getRandomCard(technologies), 'card-technology')
            };
        }
        
        function loadCards(cards) {
            cardDisplay.innerHTML = '';
            createCardElement("–°–∏—Ç—É–∞—Ü–∏—è/–ü—Ä–æ–±–ª–µ–º–∞", cards.problem, 'card-problem');
            createCardElement("–¶–µ–ª–µ–≤–∞—è –ê—É–¥–∏—Ç–æ—Ä–∏—è", cards.audience, 'card-audience');
            createCardElement("–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ –£—Å–ª–æ–≤–∏–µ", cards.condition, 'card-condition');
            createCardElement("–¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è", cards.technology, 'card-technology');
        }

        // --- 5. –§—É–Ω–∫—Ü–∏–∏ –¢–∞–π–º–µ—Ä–∞ –∏ –ù–∞—Å—Ç—Ä–æ–µ–∫ ---
        function updateTimerDisplay(totalSeconds) {
            const minutes = Math.floor(totalSeconds / 60);
            const seconds = totalSeconds % 60;
            timerDisplay.textContent = 
                `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }
        
        function handleVariantChange(event) {
            const minutes = parseInt(event.target.value);
            
            timeSlider.value = minutes;
            timeDisplay.textContent = minutes;
            updateTimerDisplay(minutes * 60);
        }

        function startTimer(playerName) {
            clearInterval(countdownInterval); 
            let timeRemaining = parseInt(timeSlider.value) * 60; 
            updateTimerDisplay(timeRemaining);
            submitTurnBtn.disabled = false;
            
            // –°–±—Ä–æ—Å —Ü–≤–µ—Ç–∞ –∏ —Å–æ–æ–±—â–µ–Ω–∏—è —Ç–∞–π–º–µ—Ä–∞
            timerDisplay.style.color = 'var(--ios-text-color)'; 
            timerMessage.textContent = `–í–∞—à–∞ –æ—á–µ—Ä–µ–¥—å, ${playerName}. –ó–∞–ø–æ–ª–Ω–∏—Ç–µ —á–µ–∫-–ª–∏—Å—Ç –∏ –Ω–∞–∂–º–∏—Ç–µ "–ü–µ—Ä–µ–¥–∞—Ç—å —Ö–æ–¥", –∫–æ–≥–¥–∞ –±—É–¥–µ—Ç–µ –≥–æ—Ç–æ–≤—ã.`;
            
            const warningThreshold = Math.min(60, Math.floor(timeRemaining / 2));

            countdownInterval = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay(timeRemaining);
                
                if (timeRemaining <= warningThreshold && timeRemaining > 0) {
                    timerDisplay.style.color = 'var(--ios-orange)'; 
                    timerMessage.textContent = `–í–ù–ò–ú–ê–ù–ò–ï, ${playerName}! –û—Å—Ç–∞–ª–æ—Å—å –º–∞–ª–æ –≤—Ä–µ–º–µ–Ω–∏ (${timeRemaining} —Å–µ–∫.). –ó–∞–≤–µ—Ä—à–∞–π—Ç–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ!`;
                } else if (timeRemaining <= 0) {
                    clearInterval(countdownInterval);
                    timerDisplay.textContent = "–í–†–ï–ú–Ø –ò–°–¢–ï–ö–õ–û";
                    timerDisplay.style.color = 'var(--ios-red)'; 
                    timerMessage.textContent = `–í—Ä–µ–º—è –¥–ª—è ${playerName} –∏—Å—Ç–µ–∫–ª–æ. –ù–∞–∂–º–∏—Ç–µ "–ü–µ—Ä–µ–¥–∞—Ç—å —Ö–æ–¥".`;
                    submitTurnBtn.disabled = false; 
                    submitTurnBtn.focus();
                } else if (timeRemaining > warningThreshold) {
                    // –£–±–µ–¥–∏–º—Å—è, —á—Ç–æ —Ü–≤–µ—Ç —Å–±—Ä–æ—à–µ–Ω, –µ—Å–ª–∏ –≤—Ä–µ–º—è –µ—â–µ –Ω–µ –≤ –∑–æ–Ω–µ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è
                    timerDisplay.style.color = 'var(--ios-text-color)';
                }
            }, 1000);
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –∏–≥—Ä–æ–∫–∞
        function displaySubmittedData(player) {
            submittedSummaryData.innerHTML = ''; 
            
            // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∏–≥—Ä–æ–∫–∞ –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ —Ä–∞—É–Ω–¥–∞
            const currentIdeaData = player.ideaData.find(d => d.round === currentRound);
            
            // ‚ö†Ô∏è –£–°–ò–õ–ï–ù–ù–ê–Ø –ü–†–û–í–ï–†–ö–ê –î–ê–ù–ù–´–•
            if (!currentIdeaData) {
                submittedSummaryData.innerHTML = `
                    <p style="opacity: 0.8; color: var(--ios-red); font-weight: 600; padding: 20px;">
                        ‚ö†Ô∏è –î–∞–Ω–Ω—ã–µ –ø—Ä–æ–µ–∫—Ç–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –¥–ª—è –†–∞—É–Ω–¥–∞ ${currentRound} –¥–ª—è –∏–≥—Ä–æ–∫–∞ ${player.name}. 
                        –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –∫–Ω–æ–ø–∫–∞ "–ü—Ä–æ–µ–∫—Ç –≥–æ—Ç–æ–≤" –±—ã–ª–∞ –Ω–∞–∂–∞—Ç–∞.
                    </p>
                `;
                return;
            }
            
            const checklist = currentIdeaData.checklist;

            for (const id in checklistFields) {
                const label = checklistFields[id];
                const rawValue = checklist[id];
                // –ó–∞–º–µ–Ω–∞ –ø–µ—Ä–µ–Ω–æ—Å–∞ —Å—Ç—Ä–æ–∫–∏ –Ω–∞ <br> –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è. –ï—Å–ª–∏ –ø—É—Å—Ç–æ, —Å—Ç–∞–≤–∏–º "–ù–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–æ"
                const value = rawValue ? rawValue.replace(/\n/g, '<br>') : "–ù–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–æ"; 
                
                const item = document.createElement('div');
                item.className = 'checklist-item';
                item.style.marginBottom = '15px'; 
                item.innerHTML = `
                    <label style="font-weight: 700; color: var(--ios-active-color);">${label}</label>
                    <p class="submitted-data-value">${value}</p>
                `;
                submittedSummaryData.appendChild(item);
            }
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–ª–µ–π –≤–≤–æ–¥–∞ –∏–º–µ–Ω –∏–≥—Ä–æ–∫–æ–≤ (—Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –≤–≤–µ–¥–µ–Ω–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π)
        function updatePlayerNameInputs() {
            const count = parseInt(playerSlider.value);
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ–∫—É—â–∏–µ –∏–º–µ–Ω–∞ –∏–∑ –∏–Ω–ø—É—Ç–æ–≤, –µ—Å–ª–∏ –æ–Ω–∏ –µ—Å—Ç—å
            const currentNames = Array.from(playerNameInputContainer.querySelectorAll('input[type="text"]')).map(input => input.value);

            playerNameInputContainer.innerHTML = '';
            for (let i = 1; i <= count; i++) {
                const input = document.createElement('input');
                input.type = 'text';
                input.id = `player-name-${i}`;
                
                // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∏–º—è –∏–∑ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –∏–Ω–ø—É—Ç–æ–≤
                const existingName = currentNames[i-1] || '';

                input.value = existingName;
                input.placeholder = `–ò–º—è –∏–≥—Ä–æ–∫–∞ ${i}`;
                
                playerNameInputContainer.appendChild(input);
            }
        }
        
        // --- 6. –û—Å–Ω–æ–≤–Ω–∞—è –õ–æ–≥–∏–∫–∞ –ò–≥—Ä—ã: –†–∞—É–Ω–¥—ã –∏ –ò–≥—Ä–æ–∫–∏ ---
        
        // –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –£–ø—Ä–æ—â–µ–Ω–Ω–∞—è –∏ –±–æ–ª–µ–µ –Ω–∞–¥–µ–∂–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –ø–µ—Ä–µ—Ö–æ–¥–∞
        function showTurnTransition(playerName, nextPhaseElement) {
            // 1. –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ —Ñ–∞–∑—ã —Å—Ä–∞–∑—É, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –º–µ—Ä—Ü–∞–Ω–∏—è
            startPhase.style.display = 'none';
            generationPhase.style.display = 'none';
            scoringPhase.style.display = 'none';
            finalResultsPhase.style.display = 'none';

            // 2. –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –æ–≤–µ—Ä–ª–µ–π –∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–µ–∫—Å—Ç –°–†–ê–ó–£
            turnOverlay.style.display = 'flex';
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–µ–∫—Å—Ç
            overlayText.innerHTML = `–•–û–î: <br>${playerName}`;
            // –ó–∞–ø—É—Å–∫–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é –ø–æ—è–≤–ª–µ–Ω–∏—è –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ
            turnOverlay.classList.add('show');
            

            // 3. –ñ–¥–µ–º 3 —Å–µ–∫—É–Ω–¥—ã –¥–ª—è –ø–æ–∫–∞–∑–∞
            setTimeout(() => {
                // –ó–∞–ø—É—Å–∫–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é –∏—Å—á–µ–∑–Ω–æ–≤–µ–Ω–∏—è
                turnOverlay.classList.remove('show');
                
                // –ñ–¥–µ–º –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∞–Ω–∏–º–∞—Ü–∏–∏ –∏—Å—á–µ–∑–Ω–æ–≤–µ–Ω–∏—è (0.5—Å)
                setTimeout(() => {
                    turnOverlay.style.display = 'none';
                    // 4. –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–ª–µ–¥—É—é—â—É—é —Ñ–∞–∑—É –ì–ê–†–ê–ù–¢–ò–†–û–í–ê–ù–ù–û
                    if (nextPhaseElement) {
                         nextPhaseElement.style.display = 'block';
                         
                         // –î–æ–±–∞–≤–ª—è–µ–º —Ñ–æ–∫—É—Å –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞
                         if (nextPhaseElement === generationPhase) {
                            document.getElementById('input-problem').focus();
                         } else if (nextPhaseElement === scoringPhase) {
                             confirmScoreBtn.focus();
                         }
                    }
                }, 500); 
            }, 3000); 
        }

        function startGame() {
            // 1. –°—á–∏—Ç—ã–≤–∞–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
            selectedTimeInMinutes = parseInt(timeSlider.value);
            const playerCount = parseInt(playerSlider.value);
            totalRounds = parseInt(roundsSlider.value);
            
            // 2. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è/–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–≥—Ä–æ–∫–æ–≤ (—Å —É—á–µ—Ç–æ–º –≤–≤–µ–¥–µ–Ω–Ω—ã—Ö –∏–º–µ–Ω)
            players = []; 
            for (let i = 1; i <= playerCount; i++) {
                const name = document.getElementById(`player-name-${i}`).value || `–ò–≥—Ä–æ–∫ ${i}`;
                players.push(new Player(name)); 
            }
           
            // 3. –°–±—Ä–æ—Å —Å–æ—Å—Ç–æ—è–Ω–∏—è —Ä–∞—É–Ω–¥–∞
            currentPlayerIndex = 0;
            currentRound = 1;
            scoringPlayerIndex = 0; 
            
            // 4. –ó–∞–ø—É—Å–∫ –ø–µ—Ä–≤–æ–≥–æ —Ä–∞—É–Ω–¥–∞ –¥–ª—è –ø–µ—Ä–≤–æ–≥–æ –∏–≥—Ä–æ–∫–∞
            startGenerationPhaseForPlayer(players[currentPlayerIndex]);
        }
        
        function startGenerationPhaseForPlayer(player) {
            // 1. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–≥–æ–ª–æ–≤–∫–∞ (–ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ–º —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∏ —Ç–µ–∫—Å—Ç)
            roundAndPlayerHeader.innerHTML = `–†–∞—É–Ω–¥ ${currentRound} | –ò–≥—Ä–æ–∫: <span class="player-name-style">${player.name}</span>`;
            
            // 2. –ì–ê–†–ê–ù–¢–ò–†–û–í–ê–ù–ù–ê–Ø –û–ß–ò–°–¢–ö–ê –ü–û–õ–ï–ô
            generationInputIds.forEach(id => {
                const textarea = document.getElementById(id);
                if (textarea) textarea.value = '';
            });
            
            // 3. –ù–æ–≤—ã–µ –∫–∞—Ä—Ç—ã
            drawCards();
            
            // 4. –°–º–µ–Ω–∞ —Ñ–∞–∑—ã (–ø–æ—Å–ª–µ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏) –∏ –∑–∞–ø—É—Å–∫ —Ç–∞–π–º–µ—Ä–∞
            showTurnTransition(player.name, generationPhase);
            startTimer(player.name);
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –∏ –ø–µ—Ä–µ—Ö–æ–¥–∞ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É –∏–≥—Ä–æ–∫—É/—Ñ–∞–∑–µ
        function submitTurnAndMoveToNext() {
            clearInterval(countdownInterval);
            const currentPlayer = players[currentPlayerIndex];
            
            // 1. –°–æ—Ö—Ä–∞–Ω—è–µ–º –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
            const checklistData = {};
            generationInputIds.forEach(id => {
                const textarea = document.getElementById(id);
                checklistData[id] = textarea ? textarea.value : '';
            });
            
            currentPlayer.ideaData.push({
                round: currentRound,
                cards: currentCards,
                checklist: checklistData
            });

            // 2. –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –µ—â–µ –∏–≥—Ä–æ–∫–∏ –≤ —Ç–µ–∫—É—â–µ–º —Ä–∞—É–Ω–¥–µ
            if (currentPlayerIndex < players.length - 1) {
                // –ü–µ—Ä–µ—Ö–æ–¥ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É –∏–≥—Ä–æ–∫—É
                currentPlayerIndex++;
                const nextPlayer = players[currentPlayerIndex];
                
                startGenerationPhaseForPlayer(nextPlayer); // –†–µ–∫—É—Ä—Å–∏–≤–Ω—ã–π –≤—ã–∑–æ–≤, –∫–æ—Ç–æ—Ä—ã–π —Å–∞–º –≤—ã–∑–æ–≤–µ—Ç showTurnTransition
            } else {
                // –í—Å–µ –∏–≥—Ä–æ–∫–∏ –∑–∞–∫–æ–Ω—á–∏–ª–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏—é. –ù–∞—á–∏–Ω–∞–µ–º —Ñ–∞–∑—É –æ—Ü–µ–Ω–∫–∏.
                startScoringPhase();
            }
        }
        
        function startScoringPhase() {
            // –ù–∞—á–∏–Ω–∞–µ–º –æ—Ü–µ–Ω–∫—É —Å –ø–µ—Ä–≤–æ–≥–æ –∏–≥—Ä–æ–∫–∞
            scoringPlayerIndex = 0; 
            
            // –ó–∞–ø—É—Å–∫ –æ—Ü–µ–Ω–∫–∏
            displayPlayerScoreView(players[scoringPlayerIndex]);
        }
        
        function displayPlayerScoreView(player) {
             // 1. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–≥–æ–ª–æ–≤–∫–∞ –æ—Ü–µ–Ω–∫–∏ (–ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ–º —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∏ —Ç–µ–∫—Å—Ç)
            scoringHeader.innerHTML = `–û—Ü–µ–Ω–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞ <span class="player-name-style">${player.name}</span> (–†–∞—É–Ω–¥ <span id="current-round-display">${currentRound}</span>)`;
            
            // 2. –°–±—Ä–æ—Å —á–µ–∫–±–æ–∫—Å–æ–≤ –¥–ª—è –Ω–æ–≤–æ–π –æ—Ü–µ–Ω–∫–∏
            document.getElementById('score-idea').checked = false;
            document.getElementById('score-presentation').checked = false;
            document.getElementById('usage-0').checked = true;
            
            // 3. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ —Å—á–µ—Ç–∞
            updateScoreboard();
            
            // 4. –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏ –∫–∞—Ä—Ç—ã
            displaySubmittedData(player);
            
            const currentIdeaData = player.ideaData.find(d => d.round === currentRound);
            if (currentIdeaData) {
                loadCards(currentIdeaData.cards);
            }
            
            // 5. –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ñ–∞–∑—É –æ—Ü–µ–Ω–∫–∏ —á–µ—Ä–µ–∑ –æ–≤–µ—Ä–ª–µ–π
            const overlayMessage = (scoringPlayerIndex === 0 && currentRound === 1) 
                                 ? `–ù–ê–ß–ê–õ–û –û–¶–ï–ù–ö–ò` 
                                 : `–û–¶–ï–ù–ö–ê: <br>${player.name}`;
                                 
            showTurnTransition(overlayMessage, scoringPhase);
        }

        // –§—É–Ω–∫—Ü–∏—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –æ—Ü–µ–Ω–∫–∏ –∏ –ø–µ—Ä–µ—Ö–æ–¥–∞ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É –∏–≥—Ä–æ–∫—É/—Ä–∞—É–Ω–¥—É/—Ñ–∏–Ω–∞–ª—É
        function confirmScoreAndMoveToNext() {
            let totalScore = 0;
            const currentPlayer = players[scoringPlayerIndex];

            // 1. –ë–∞–∑–æ–≤—ã–µ –û—á–∫–∏ (–ú–∞–∫—Å 2)
            const ideaScore = document.getElementById('score-idea').checked ? 1 : 0;
            const presentationScore = document.getElementById('score-presentation').checked ? 1 : 0;
            totalScore += ideaScore + presentationScore;

            // 2. –ë–æ–Ω—É—Å–Ω—ã–µ –û—á–∫–∏ (–ú–∞–∫—Å 2)
            const cardUsageRadios = document.getElementsByName('card-usage');
            let bonusScore = 0;
            for (const radio of cardUsageRadios) {
                if (radio.checked) {
                    bonusScore = parseInt(radio.value);
                    break;
                }
            }
            totalScore += bonusScore;
            
            // 3. –ü—Ä–∏–º–µ–Ω—è–µ–º —Å—á–µ—Ç –∫ —Ç–µ–∫—É—â–µ–º—É –∏–≥—Ä–æ–∫—É
            // –î–æ–±–∞–≤–ª—è–µ–º —Å—á–µ—Ç –≤ –º–∞—Å—Å–∏–≤ roundScores
            currentPlayer.addScore(totalScore); 
            
            // 4. –ü–µ—Ä–µ—Ö–æ–¥ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —à–∞–≥—É
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –µ—â–µ –∏–≥—Ä–æ–∫–∏ –¥–ª—è –æ—Ü–µ–Ω–∫–∏ –≤ —Ç–µ–∫—É—â–µ–º —Ä–∞—É–Ω–¥–µ
            if (scoringPlayerIndex < players.length - 1) {
                // –ü–µ—Ä–µ—Ö–æ–¥ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É –∏–≥—Ä–æ–∫—É –¥–ª—è –æ—Ü–µ–Ω–∫–∏
                scoringPlayerIndex++;
                const nextPlayer = players[scoringPlayerIndex];
                displayPlayerScoreView(nextPlayer);
            } else {
                // –í—Å–µ –∏–≥—Ä–æ–∫–∏ –≤ —Ä–∞—É–Ω–¥–µ –æ—Ü–µ–Ω–µ–Ω—ã.
                moveToNextRoundOrResults();
            }
        }
        
        function moveToNextRoundOrResults() {
            // 1. –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –µ—â–µ —Ä–∞—É–Ω–¥—ã
            if (currentRound < totalRounds) {
                // –ù–∞—á–∏–Ω–∞–µ–º –Ω–æ–≤—ã–π —Ä–∞—É–Ω–¥
                currentRound++;
                currentPlayerIndex = 0; // –ù–∞—á–∏–Ω–∞–µ–º –≥–µ–Ω–µ—Ä–∞—Ü–∏—é —Å –ø–µ—Ä–≤–æ–≥–æ –∏–≥—Ä–æ–∫–∞
                
                // –ü–µ—Ä–µ—Ö–æ–¥ —á–µ—Ä–µ–∑ –≥–µ–Ω–µ—Ä–∞—Ü–∏—é –ø–µ—Ä–≤–æ–≥–æ –∏–≥—Ä–æ–∫–∞
                startGenerationPhaseForPlayer(players[currentPlayerIndex]);
            } else {
                // 2. –ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞. –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ñ–∏–Ω–∞–ª—å–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã.
                displayFinalResults();
            }
        }
        
        function updateScoreboard() {
            let tableHTML = `
                <thead>
                    <tr>
                        <th>–ò–≥—Ä–æ–∫/–ö–æ–º–∞–Ω–¥–∞</th>
            `;
            // –ó–∞–≥–æ–ª–æ–≤–∫–∏ —Ä–∞—É–Ω–¥–æ–≤
            // –î–ª—è —Ç–µ–∫—É—â–µ–≥–æ —Ä–∞—É–Ω–¥–∞, –∫–æ—Ç–æ—Ä—ã–π –æ—Ü–µ–Ω–∏–≤–∞–µ—Ç—Å—è, –∑–∞–≥–æ–ª–æ–≤–æ–∫ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å
            for (let r = 1; r <= currentRound; r++) {
                tableHTML += `<th>–†. ${r}</th>`;
            }
            tableHTML += `<th>–°–£–ú–ú–ê</th></tr></thead><tbody>`;
            
            // –°—Ç—Ä–æ–∫–∏ –∏–≥—Ä–æ–∫–æ–≤
            players.forEach(player => {
                tableHTML += `<tr><td>${player.name}</td>`;
                
                // –ë–∞–ª–ª—ã –∑–∞ —Ä–∞—É–Ω–¥—ã
                // –ò—Ç–µ—Ä–∞—Ü–∏—è –ø–æ —á–∏—Å–ª—É —Ç–µ–∫—É—â–µ–≥–æ —Ä–∞—É–Ω–¥–∞
                for (let r = 0; r < currentRound; r++) { 
                    const score = player.roundScores[r] !== undefined ? player.roundScores[r] : '-';
                    tableHTML += `<td>${score}</td>`;
                }
                
                // –û–±—â–∏–π —Å—á–µ—Ç
                tableHTML += `<td>${player.score}</td></tr>`;
            });
            
            tableHTML += `</tbody>`;
            scoreboardTable.innerHTML = tableHTML;
        }


        function displayFinalResults() {
            // –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –∏–≥—Ä–æ–∫–æ–≤ –ø–æ —Å—á–µ—Ç—É –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ä–µ–π—Ç–∏–Ω–≥–∞
            const sortedPlayers = [...players].sort((a, b) => b.score - a.score);

            let tableHTML = `
                <thead>
                    <tr>
                        <th>–ú–ï–°–¢–û</th>
                        <th>–ò–ú–Ø –ò–ì–†–û–ö–ê/–ö–û–ú–ê–ù–î–´</th>
                        <th>–û–ë–©–ò–ô –°–ß–ï–¢</th>
                    </tr>
                </thead>
                <tbody>
            `;

            sortedPlayers.forEach((player, index) => {
                const rank = index + 1;
                let rankIcon = '';
                let rankStyle = '';
                
                if (rank === 1) { rankIcon = 'ü•á'; rankStyle = 'color: var(--ios-orange); font-weight: 700;'; }
                else if (rank === 2) { rankIcon = 'ü•à'; rankStyle = 'color: silver;'; }
                else if (rank === 3) { rankIcon = 'ü•â'; rankStyle = 'color: #b08d57;'; }
                else { rankIcon = 'üèÖ'; }
                
                tableHTML += `
                    <tr>
                        <td style="${rankStyle}">${rankIcon} ${rank}</td>
                        <td>${player.name}</td>
                        <td style="color: var(--ios-green); font-weight: 700;">${player.score}</td>
                    </tr>
                `;
            });
            
            tableHTML += `</tbody>`;
            finalRankingTable.innerHTML = tableHTML;
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ñ–∏–Ω–∞–ª—å–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —á–µ—Ä–µ–∑ –æ–≤–µ—Ä–ª–µ–π
            showTurnTransition(`–ò–ì–†–ê –û–ö–û–ù–ß–ï–ù–ê`, finalResultsPhase);
        }


        // --- 7. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –°–æ–±—ã—Ç–∏–π ---
        document.addEventListener('DOMContentLoaded', () => {
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏–º–µ–Ω –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
            updatePlayerNameInputs();

            // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–ª–∞–π–¥–µ—Ä–æ–≤
            timeSlider.addEventListener('input', () => {
                timeDisplay.textContent = timeSlider.value;
                updateTimerDisplay(parseInt(timeSlider.value) * 60);
            });
            playerSlider.addEventListener('input', () => {
                playerDisplay.textContent = playerSlider.value;
                updatePlayerNameInputs(); // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–ª–µ–π —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º
            });
            roundsSlider.addEventListener('input', () => {
                roundsDisplay.textContent = roundsSlider.value;
            });

            // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤—ã–±–æ—Ä–∞ –≤–∞—Ä–∏–∞–Ω—Ç–∞ –∏–≥—Ä—ã
            gameVariantOptions.forEach(radio => {
                radio.addEventListener('change', handleVariantChange);
            });
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤—Ä–µ–º–µ–Ω–∏ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: 3 –º–∏–Ω—É—Ç—ã)
            updateTimerDisplay(parseInt(timeSlider.value) * 60);

            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–Ω–æ–ø–æ–∫
            document.getElementById('start-game-btn').addEventListener('click', startGame);
            document.getElementById('submit-turn-btn').addEventListener('click', submitTurnAndMoveToNext); 
            document.getElementById('confirm-score-btn').addEventListener('click', confirmScoreAndMoveToNext); 
            
            // –ü–æ–ª–Ω—ã–π —Å–±—Ä–æ—Å –∏–≥—Ä—ã
            document.getElementById('restart-game-btn').addEventListener('click', () => {
                // –°–±—Ä–æ—Å –≤—Å–µ—Ö —Ñ–∞–∑
                startPhase.style.display = 'block';
                generationPhase.style.display = 'none';
                scoringPhase.style.display = 'none';
                finalResultsPhase.style.display = 'none';
                
                // –°–±—Ä–æ—Å —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏–≥—Ä—ã
                players = []; // –ü–æ–ª–Ω–æ–µ –æ–±–Ω—É–ª–µ–Ω–∏–µ –º–∞—Å—Å–∏–≤–∞ –∏–≥—Ä–æ–∫–æ–≤
                currentPlayerIndex = 0;
                currentRound = 1;
                scoringPlayerIndex = 0; 
                
                // –û—á–∏—Å—Ç–∫–∞ –ø–æ–ª–µ–π –≤–≤–æ–¥–∞ –∏–º–µ–Ω
                const playerCount = parseInt(playerSlider.value);
                for (let i = 1; i <= playerCount; i++) {
                     const input = document.getElementById(`player-name-${i}`);
                     if(input) input.value = '';
                }
                updatePlayerNameInputs(); // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–ª–µ–π –≤–≤–æ–¥–∞ –∏–º–µ–Ω
                
                // –°–±—Ä–æ—Å —Ç–∞–π–º–µ—Ä–∞ –Ω–∞ –≤—ã–±—Ä–∞–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
                selectedTimeInMinutes = parseInt(timeSlider.value);
                updateTimerDisplay(selectedTimeInMinutes * 60);
                cardDisplay.innerHTML = '';
                
                // –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
                roundAndPlayerHeader.innerHTML = `–†–∞—É–Ω–¥ 1 | –ò–≥—Ä–æ–∫: <span class="player-name-style">–ò–≥—Ä–æ–∫ 1</span>`;
                scoringHeader.innerHTML = `–û—Ü–µ–Ω–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞ <span class="player-name-style">–ò–≥—Ä–æ–∫ 1</span> (–†–∞—É–Ω–¥ <span id="current-round-display">1</span>)`;
            });
        });
    </script>
</body>
</html>